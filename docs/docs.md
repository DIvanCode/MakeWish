* [Техническое задание](docs/docs.md#техническое_задание)
  * [Сущности](docs/docs.md#сущности)
  * [Сценарии](docs/docs.md#сценарии)
  * [Схема данных](docs/docs.md#схема_данных)
* [Архитектура системы](docs/docs.md#архитектура_системы)
  * [Микросервисы](docs/docs.md#микросервисы)
  * [Взаимодействие](docs/docs.md#взаимодействие)
  * [API Gateway](docs/docs.md#api_gateway)
  * [Хранилище](docs/docs.md#хранилише)
* [UserService](docs/docs.md#userservice)
  * [Функционал](docs/docs.md#функционал)
  * [База данных](docs/docs.md#база_данных)
  * [Архитектура приложения](docs/docs.md#архитектура_приложения)
* [WishService](docs/docs.md#wishservice)
  * [Функционал](docs/docs.md#функционал-1)
  * [База данных](docs/docs.md#база_данных-1)
  * [Архитектура приложения](docs/docs.md#архитектура_приложения-1)

# Техническое задание

## Сущности

### Аккаунт

- Аккаунт пользователя имеет уникальный идентификатор, а также электронную почту, пароль, имя, фамилию пользователя.
- Два аккаунта могут иметь связь “друзья”.

### Желание

- Желание имеет уникальный идентификатор, название, описание, статус.
- Статус принимает одно из следующих значений:
    - создано
    - выполняется
    - ожидает подтверждения
    - выполнено

### Список желаний

- Список желаний имеет уникальный идентификатор и содержит в себе ноль или более желаний.

## Сценарии

### Создание аккаунта (регистрация)

- Пользователь имеет возможность создать свой аккаунт по электронной почте и паролю.
- При регистрации указываются имя и фамилия.
- Два аккаунта не могут иметь одинаковую электронную почту.
- При создании аккаунта происходит создание начального списка желаний, привязанного к этому аккаунту.

### Вход в систему

- Для совершения всех действий в системе пользователь должен проходить авторизацию.
- Для идентификации используется электронная почта, указываемая при регистрации.
- Для аутентификации используется пароль, указываемый при регистрации.
- Для дальнейшей авторизации используется токен, выдаваемый после успешной аутентификации при входе в систему.

### Добавление в друзья - шаг I (создание заявки)

- Пользователь имеет возможность создать заявку на добавление связи “друзья” с аккаунтом другого пользователя.
- Аккаунты пользователей не должны иметь связь “друзья”.
- В любой момент времени не должно существовать более одной заявки между двумя аккаунтами пользователей.

### Добавление в друзья - шаг II (одобрение заявки)

- Пользователь имеет возможность одобрить заявку на добавление связи “друзья” с аккаунтом другого пользователя.
- В случае одобрения заявки аккаунты этих пользователей начинают иметь связь “друзья”.
- Аккаунту каждого из пользователей выдаются права на просмотр начального списка желаний, привязанного к другому аккаунту.

### Удаление из друзей

- Пользователь имеет возможность удалить связь “друзья” с аккаунтом другого пользователя.
- Аккаунты пользователей должны иметь связь “друзья”.

### Просмотр списка друзей

- Пользователь имеет возможность просмотреть список аккаунтов пользователей, с которыми его аккаунт имеет связь “друзья”.

### Просмотр заявок на добавление в друзья

- Пользователь имеет возможность просмотреть список заявок на добавление связи “друзья” с его аккаунтом от других пользователей.

### Создание желания

- Пользователь имеет возможность создать желание.
- Аккаунт пользователя получает связь “владеет” с желанием.
- Ровно один аккаунт может иметь связь “владеет” с желанием.
- При создании желание получает статус “создано”.
- При создании желание автоматически попадает в начальный список желаний пользователя.

### Редактирование желания

- Пользователь имеет возможность редактировать желание.
- Аккаунт пользователя должен иметь связь “владеет” с желанием.
- Желание должно иметь статус “создано”.
- При редактировании можно изменить название, описание.

### Удаление желания

- Пользователь имеет возможность удалить желание.
- Аккаунт пользователя должен иметь связь “владеет” с желанием.
- Желание должно иметь статус “создано” или “выполнено”.

### Просмотр своего желания

- Пользователь имеет возможность просмотреть желание.
- Аккаунт пользователя должен иметь связь “владеет” с желанием.
- Если желание имеет статус “выполняется”, пользователю показывается статус “создано”.

### Просмотр чужого желания

- Пользователь имеет возможность просмотреть желание, с которым его аккаунт не имеет связь “владеет”.
- Пользователь должен иметь право на просмотр какого-либо списка желаний, который имеет связь “содержит” с этим желанием.

### Создание списка желаний

- Пользователь имеет возможность создать список желаний.
- Автоматическое создание списка желаний происходит при регистрации аккаунта пользователя.
- Аккаунт пользователя получает связь “владеет” со списком желаний.

### Добавление желания в список желаний

- Пользователь имеет возможность добавить желание в список желаний.
- Аккаунт пользователя должен иметь связь “владеет” с желанием.
- Аккаунт пользователя должен иметь связь “владеет” со списком желаний.
- Список желаний не должен иметь связь “содержит” с желанием.
- Список желаний получает связь “содержит” с желанием.
- Желание имеет возможность содержаться в нескольких списках желаний.

### Просмотр своего списка желаний

- Пользователь имеет возможность посмотреть все желания, находящиеся в определенном списке желаний.
- Аккаунт пользователя должен иметь связь “владеет” со списком желаний.
- Если желание имеет статус “выполняется”, пользователю показывается статус “создано”.

### Просмотр чужого списка желаний

- Пользователь имеет возможность просмотреть список желаний, которым “владеет” аккаунт другого пользователя.
- Аккаунт пользователя должен иметь право на просмотр этого списка желаний.
- В списке отображаются только те желания, которые имеют статус “создано”.

### Выдача права на просмотр своего списка желаний другому пользователю

- Пользователь имеет возможность выдать права на просмотр списка желаний аккаунту другого пользователя.
- Аккаунт первого пользователя должен иметь связь “владеет” со списком желаний.
- Аккаунт второго пользователя получает право на просмотр этого списка желаний.

### Выбор желания другого пользователя для выполнения

- Пользователь имеет возможность выбрать желание другого пользователя и сказать системе, что хочет его выполнить.
- В любой момент времени не более чем один аккаунт может иметь связь “выполняет” с одним и тем же желанием.
- Аккаунт пользователя должен иметь право на просмотр желания.
- Желание должно иметь статус “создано”.
- Желание получает статус “выполняется”.
- Система запоминает пользователя и связывает с желанием связью “выполняет”.

### Просмотр списка выполняемых желаний

- Пользователь имеет возможность посмотреть список желаний, с которыми его аккаунт имеет связь “выполняет”.

### Отказ от выполнения желания другого пользователя

- Пользователь имеет возможность отказаться от выполнения желания.
- Аккаунт пользователя должен иметь связь “выполняет” с желанием.
- Желание получает статус “создано”.

### Выполнение своего желания до конца

- Пользователь имеет возможность выполнить свое желание.
- Аккаунт пользователя должен иметь связь “владеет” с желанием.
- Желание получает статус “выполнено”.
- Система запоминает, что желание было выполнено этим пользователем.

### Выполнение чужого желания до конца

- Пользователь имеет возможность выполнить чужое желание.
- Аккаунт пользователя должен иметь связь “выполняет” с желанием.
- Желание получает статус “ожидает подтверждения”.

### Подтверждение выполнения желания

- Пользователь имеет возможность подтвердить, что желание действительно было выполнено.
- Аккаунт пользователя должен иметь связь “владеет” с желанием.
- Желание должно иметь статус “ожидает подтверждения”.
- При подтверждении желание получает статус “выполнено”.
- Система запоминает аккаунт пользователя, выполнившего это желание.
- При отклонении желание получает статус “выполняется”.

## Схема данных

Общая схема сущностей и их отношений выглядит следующим образом:

<img src="/docs/MakeWish.Common.DB.Schema.png" />

# Архитектура приложения

<img src="/docs/MakeWish.Architecture.png" />

## Микросервисы

Функционал разбит на два микросервиса:
1. UserService - сервис, отвечающий за работу с пользователями.
2. WishService - сервис, отвечающий за работу с желаниями.

## Взаимодействие

В UserService происходят события, на которые WishService должен реагировать.
Для обеспечения низкой связности между микросервисами будет использован брокер обмена сообщениями - Message Bus.

## API Gateway

С внешним миром приложение общается через единую точку входа - API Gateway, выполняющего функции обратного прокси и балансировки нагрузки.

## Хранилище

У каждого сервиса есть своя база данных:
1. UserService использует реляционную модель хранения данных.
2. WishService использует графовую модель хранения данных.

# UserService

## Функционал

Сервис отвечает за следующий функционал:
1. Работа с моделями пользователей (создание, редактирование).
2. Регистрация, аутентификация.
3. Добавление пользователей в друзья (создание заявки на добавление, одобрение заявки).

## База данных

Достаточно частые операции - поиск пользователя по email для аутентификации и просмотр списка своих друзей.
В качестве базы данных подходит простая реляционная модель.
Будет использоваться Postgresql.

<img src="/docs/MakeWish.UserService.Postgres.png" />

## Архитектура приложения

<img src="/docs/MakeWish.UserService.png" />

# WishService

## Функционал

Сервис отвечает за следующий функционал:
1. Работу с моделями желаний (создание, редактирование, удаление, просмотр).
2. Работу со списками желаний (создание, редактирование, удаление, добавление желаний, удаление желаний).
3. Выдача и проверка прав доступа на чтение и изменение списков желаний.
4. Планирование выполнения и выполнение желаний.

## База данных

Самой тяжелой операцией является проверка прав доступа на просмотр желания.
Если использовать реляционную модель, придется делать 3 join операции.
В качестве базы данных достаточно лаконично смотрится графовая модель.
Будет использоваться Neo4j.

<img src="/docs/MakeWish.WishService.Neo4j.png" />

## Архитектура приложения

<img src="/docs/MakeWish.WishService.png" />
